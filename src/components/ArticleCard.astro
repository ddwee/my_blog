---
import type { CollectionEntry } from 'astro:content';

interface Props {
  post: CollectionEntry<'articles'>;
  filterType?: string;
  filterValue?: string;
}

const { post, filterType, filterValue } = Astro.props;

// IDから.md拡張子を除去
const postId = post.id.replace(/\.md$/, '');
---

<article>
  <div class="date">{post.data.date}</div>
  <h2><a href={`/article/${postId}`} class="article-link" data-article-id={postId} data-filter-type={filterType} data-filter-value={filterValue}>{post.data.title}</a></h2>
  <div class="meta">
    <a href={`/category/${post.data.category}`} class="category">{post.data.category}</a>
    {post.data.tags && (
      <div class="tags">
        {post.data.tags.map(tag => (
          <a href={`/tag/${tag}`} class="tag">#{tag}</a>
        ))}
      </div>
    )}
  </div>
</article>

<script>
  function initArticleLinks() {
    document.querySelectorAll('.article-link').forEach(link => {
      link.addEventListener('click', (e) => {
        sessionStorage.setItem('returnUrl', window.location.pathname);
        
        const filterType = link.getAttribute('data-filter-type');
        const filterValue = link.getAttribute('data-filter-value');
        
        if (filterType && filterValue) {
          sessionStorage.setItem('filterType', filterType);
          sessionStorage.setItem('filterValue', filterValue);
        } else {
          sessionStorage.removeItem('filterType');
          sessionStorage.removeItem('filterValue');
        }
      });
    });
  }

  initArticleLinks();
  document.addEventListener('astro:page-load', initArticleLinks);
</script>